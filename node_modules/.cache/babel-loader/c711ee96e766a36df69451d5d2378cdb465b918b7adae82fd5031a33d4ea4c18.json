{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, vModelSelect as _vModelSelect, vModelCheckbox as _vModelCheckbox, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container py-4\"\n};\nconst _hoisted_2 = {\n  class: \"mb-3\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"mb-3\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"mb-3\"\n};\nconst _hoisted_5 = {\n  key: 2,\n  class: \"mb-3\"\n};\nconst _hoisted_6 = {\n  class: \"mb-3\"\n};\nconst _hoisted_7 = [\"value\"];\nconst _hoisted_8 = {\n  class: \"mb-3\"\n};\nconst _hoisted_9 = [\"value\"];\nconst _hoisted_10 = {\n  key: 3,\n  class: \"form-check\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"h1\", null, _toDisplayString($data.editMode ? 'Редактировать' : 'Добавить') + \" пользователя\", 1 /* TEXT */), _createElementVNode(\"form\", {\n    onSubmit: _cache[7] || (_cache[7] = _withModifiers((...args) => $options.submitForm && $options.submitForm(...args), [\"prevent\"]))\n  }, [_createElementVNode(\"div\", _hoisted_2, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Имя\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.form.name = $event),\n    type: \"text\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.name]])]), $data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Фамилия\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.form.firstname = $event),\n    type: \"text\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.firstname]])])) : _createCommentVNode(\"v-if\", true), !$data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_cache[10] || (_cache[10] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Логин\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.form.username = $event),\n    type: \"text\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.username]])])) : _createCommentVNode(\"v-if\", true), !$data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_5, [_cache[11] || (_cache[11] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Пароль\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.form.password = $event),\n    type: \"password\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.password]])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_6, [_cache[12] || (_cache[12] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Должность\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.form.user_type = $event),\n    class: \"form-select\",\n    required: \"\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.roles, role => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: role,\n      value: role\n    }, _toDisplayString(role), 9 /* TEXT, PROPS */, _hoisted_7);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $data.form.user_type]])]), _createElementVNode(\"div\", _hoisted_8, [_cache[13] || (_cache[13] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Цех\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.form.workshops = $event),\n    class: \"form-select\",\n    multiple: \"\",\n    required: \"\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.workshops, workshop => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: workshop,\n      value: workshop\n    }, _toDisplayString(workshop), 9 /* TEXT, PROPS */, _hoisted_9);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $data.form.workshops]]), _cache[14] || (_cache[14] = _createElementVNode(\"small\", {\n    class: \"text-muted\"\n  }, \"Удерживайте Ctrl (Cmd на Mac), чтобы выбрать несколько\", -1 /* HOISTED */))]), $data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, [_withDirectives(_createElementVNode(\"input\", {\n    class: \"form-check-input\",\n    type: \"checkbox\",\n    \"onUpdate:modelValue\": _cache[6] || (_cache[6] = $event => $data.form.is_active = $event)\n  }, null, 512 /* NEED_PATCH */), [[_vModelCheckbox, $data.form.is_active]]), _cache[15] || (_cache[15] = _createElementVNode(\"label\", {\n    class: \"form-check-label\"\n  }, \"Активен\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true), _cache[17] || (_cache[17] = _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"btn btn-primary mt-3\"\n  }, \"Сохранить\", -1 /* HOISTED */)), _createVNode(_component_router_link, {\n    to: \"/admin/users\",\n    class: \"btn btn-secondary mt-3 ms-2\"\n  }, {\n    default: _withCtx(() => _cache[16] || (_cache[16] = [_createTextVNode(\"Отмена\")])),\n    _: 1 /* STABLE */\n  })], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_toDisplayString","$data","editMode","onSubmit","_cache","_withModifiers","args","$options","submitForm","_hoisted_2","$event","form","name","type","required","_hoisted_3","firstname","_createCommentVNode","_hoisted_4","username","_hoisted_5","password","_hoisted_6","user_type","_Fragment","_renderList","roles","role","value","_hoisted_7","_hoisted_8","workshops","multiple","workshop","_hoisted_9","_hoisted_10","is_active","_createVNode","_component_router_link","to","default","_withCtx","_createTextVNode","_"],"sources":["C:\\Users\\nikec\\frontend\\src\\components\\UserForm.vue"],"sourcesContent":["<template>\r\n    <div class=\"container py-4\">\r\n      <h1>{{ editMode ? 'Редактировать' : 'Добавить' }} пользователя</h1>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Имя</label>\r\n          <input v-model=\"form.name\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n        <div v-if=\"editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Фамилия</label>\r\n          <input v-model=\"form.firstname\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Логин</label>\r\n          <input v-model=\"form.username\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Пароль</label>\r\n          <input v-model=\"form.password\" type=\"password\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Должность</label>\r\n          <select v-model=\"form.user_type\" class=\"form-select\" required>\r\n            <option v-for=\"role in roles\" :key=\"role\" :value=\"role\">{{ role }}</option>\r\n          </select>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Цех</label>\r\n          <select v-model=\"form.workshops\" class=\"form-select\" multiple required>\r\n            <option v-for=\"workshop in workshops\" :key=\"workshop\" :value=\"workshop\">{{ workshop }}</option>\r\n          </select>\r\n          <small class=\"text-muted\">Удерживайте Ctrl (Cmd на Mac), чтобы выбрать несколько</small>\r\n        </div>\r\n  \r\n        <div v-if=\"editMode\" class=\"form-check\">\r\n          <input class=\"form-check-input\" type=\"checkbox\" v-model=\"form.is_active\" />\r\n          <label class=\"form-check-label\">Активен</label>\r\n        </div>\r\n  \r\n        <button type=\"submit\" class=\"btn btn-primary mt-3\">Сохранить</button>\r\n        <router-link to=\"/admin/users\" class=\"btn btn-secondary mt-3 ms-2\">Отмена</router-link>\r\n      </form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    name: 'UserForm',\r\n    data() {\r\n      return {\r\n        editMode: false,\r\n        userId: null,\r\n        form: {\r\n          name: '',\r\n          firstname: '',\r\n          username: '',\r\n          password: '',\r\n          user_type: '',\r\n          workshops: [],\r\n          is_active: true,\r\n        },\r\n        roles: [],\r\n        workshops: [],\r\n      };\r\n    },\r\n    async created() {\r\n      const { id } = this.$route.params;\r\n      this.editMode = !!id;\r\n      this.userId = id;\r\n      const token = localStorage.getItem('auth_token');\r\n        if (!token) {\r\n          throw new Error('Токен не найден! Пожалуйста, войдите в систему.');\r\n        }\r\n      try {\r\n        const metaRes = await fetch(this.editMode \r\n          ? `/api/admin/users/${id}/edit` \r\n          : `/api/admin/users/create`);\r\n        const metaData = await metaRes.json();\r\n  \r\n        this.roles = metaData.roles;\r\n        this.workshops = metaData.workshops;\r\n  \r\n        if (this.editMode) {\r\n          const u = metaData.user_obj;\r\n          this.form.name = u.name;\r\n          this.form.firstname = u.firstname;\r\n          this.form.username = u.username;\r\n          this.form.user_type = u.user_type;\r\n          this.form.workshops = metaData.user_workshops;\r\n          this.form.is_active = u.is_active ?? true;\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Ошибка при загрузке данных:\", err);\r\n      }\r\n    },\r\n    methods: {\r\n      async submitForm() {\r\n        const token = localStorage.getItem('auth_token');\r\n        if (!token) {\r\n          throw new Error('Токен не найден! Пожалуйста, войдите в систему.');\r\n        }\r\n  \r\n        const payload = { ...this.form };\r\n  \r\n        if (this.editMode) {\r\n          payload.id = this.userId;\r\n          // Если не меняем пароль — можно удалить поле или поставить \"заглушку\"\r\n          // delete payload.password;\r\n        }\r\n  \r\n        const response = await fetch('/api/admin/users/save', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json',\r\n          },\r\n          body: JSON.stringify(payload),\r\n        });\r\n  \r\n        if (response.ok) {\r\n          this.$router.push('/admin/users');\r\n        } else {\r\n          const error = await response.json();\r\n          alert(`Ошибка: ${error.detail}`);\r\n        }\r\n      }\r\n    }\r\n  };\r\n  </script>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}