{"ast":null,"code":"import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, vModelSelect as _vModelSelect, vModelCheckbox as _vModelCheckbox, createTextVNode as _createTextVNode, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, withModifiers as _withModifiers } from \"vue\";\nconst _hoisted_1 = {\n  class: \"container py-4\"\n};\nconst _hoisted_2 = {\n  class: \"mb-3\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"mb-3\"\n};\nconst _hoisted_4 = {\n  key: 1,\n  class: \"mb-3\"\n};\nconst _hoisted_5 = {\n  class: \"mb-3\"\n};\nconst _hoisted_6 = [\"value\"];\nconst _hoisted_7 = {\n  class: \"mb-3\"\n};\nconst _hoisted_8 = [\"value\"];\nconst _hoisted_9 = {\n  key: 2,\n  class: \"form-check\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_router_link = _resolveComponent(\"router-link\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"h1\", null, _toDisplayString($data.editMode ? 'Редактировать' : 'Добавить') + \" пользователя\", 1 /* TEXT */), _createElementVNode(\"form\", {\n    onSubmit: _cache[6] || (_cache[6] = _withModifiers((...args) => $options.submitForm && $options.submitForm(...args), [\"prevent\"]))\n  }, [_createElementVNode(\"div\", _hoisted_2, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Имя\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $data.form.name = $event),\n    type: \"text\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.name]])]), !$data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Логин\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $data.form.username = $event),\n    type: \"text\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.username]])])) : _createCommentVNode(\"v-if\", true), !$data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Пароль\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $data.form.password = $event),\n    type: \"password\",\n    class: \"form-control\",\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $data.form.password]])])) : _createCommentVNode(\"v-if\", true), _createElementVNode(\"div\", _hoisted_5, [_cache[10] || (_cache[10] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Должность\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = $event => $data.form.user_type = $event),\n    class: \"form-select\",\n    required: \"\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.roles, role => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: role,\n      value: role\n    }, _toDisplayString(role), 9 /* TEXT, PROPS */, _hoisted_6);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $data.form.user_type]])]), _createElementVNode(\"div\", _hoisted_7, [_cache[11] || (_cache[11] = _createElementVNode(\"label\", {\n    class: \"form-label\"\n  }, \"Цех\", -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"select\", {\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = $event => $data.form.workshops = $event),\n    class: \"form-select\",\n    multiple: \"\",\n    required: \"\"\n  }, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.workshops, workshop => {\n    return _openBlock(), _createElementBlock(\"option\", {\n      key: workshop,\n      value: workshop\n    }, _toDisplayString(workshop), 9 /* TEXT, PROPS */, _hoisted_8);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */), [[_vModelSelect, $data.form.workshops]]), _cache[12] || (_cache[12] = _createElementVNode(\"small\", {\n    class: \"text-muted\"\n  }, \"Удерживайте Ctrl (Cmd на Mac), чтобы выбрать несколько\", -1 /* HOISTED */))]), $data.editMode ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_withDirectives(_createElementVNode(\"input\", {\n    class: \"form-check-input\",\n    type: \"checkbox\",\n    \"onUpdate:modelValue\": _cache[5] || (_cache[5] = $event => $data.form.is_active = $event)\n  }, null, 512 /* NEED_PATCH */), [[_vModelCheckbox, $data.form.is_active]]), _cache[13] || (_cache[13] = _createElementVNode(\"label\", {\n    class: \"form-check-label\"\n  }, \"Активен\", -1 /* HOISTED */))])) : _createCommentVNode(\"v-if\", true), _cache[15] || (_cache[15] = _createElementVNode(\"button\", {\n    type: \"submit\",\n    class: \"btn btn-primary mt-3\"\n  }, \"Сохранить\", -1 /* HOISTED */)), _createVNode(_component_router_link, {\n    to: \"/admin/users\",\n    class: \"btn btn-secondary mt-3 ms-2\"\n  }, {\n    default: _withCtx(() => _cache[14] || (_cache[14] = [_createTextVNode(\"Отмена\")])),\n    _: 1 /* STABLE */\n  })], 32 /* NEED_HYDRATION */)]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_toDisplayString","$data","editMode","onSubmit","_cache","_withModifiers","args","$options","submitForm","_hoisted_2","$event","form","name","type","required","_hoisted_3","username","_createCommentVNode","_hoisted_4","password","_hoisted_5","user_type","_Fragment","_renderList","roles","role","value","_hoisted_6","_hoisted_7","workshops","multiple","workshop","_hoisted_8","_hoisted_9","is_active","_createVNode","_component_router_link","to","default","_withCtx","_createTextVNode","_"],"sources":["C:\\Users\\nikec\\frontend\\src\\components\\UserForm.vue"],"sourcesContent":["<template>\r\n    <div class=\"container py-4\">\r\n      <h1>{{ editMode ? 'Редактировать' : 'Добавить' }} пользователя</h1>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Имя</label>\r\n          <input v-model=\"form.name\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n        \r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Логин</label>\r\n          <input v-model=\"form.username\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Пароль</label>\r\n          <input v-model=\"form.password\" type=\"password\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Должность</label>\r\n          <select v-model=\"form.user_type\" class=\"form-select\" required>\r\n            <option v-for=\"role in roles\" :key=\"role\" :value=\"role\">{{ role }}</option>\r\n          </select>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Цех</label>\r\n          <select v-model=\"form.workshops\" class=\"form-select\" multiple required>\r\n            <option v-for=\"workshop in workshops\" :key=\"workshop\" :value=\"workshop\">{{ workshop }}</option>\r\n          </select>\r\n          <small class=\"text-muted\">Удерживайте Ctrl (Cmd на Mac), чтобы выбрать несколько</small>\r\n        </div>\r\n  \r\n        <div v-if=\"editMode\" class=\"form-check\">\r\n          <input class=\"form-check-input\" type=\"checkbox\" v-model=\"form.is_active\" />\r\n          <label class=\"form-check-label\">Активен</label>\r\n        </div>\r\n  \r\n        <button type=\"submit\" class=\"btn btn-primary mt-3\">Сохранить</button>\r\n        <router-link to=\"/admin/users\" class=\"btn btn-secondary mt-3 ms-2\">Отмена</router-link>\r\n      </form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  export default {\r\n    name: 'UserForm',\r\n    data() {\r\n      return {\r\n        editMode: false,\r\n        userId: null,\r\n        form: {\r\n          name: '',\r\n          username: '',\r\n          password: '',\r\n          user_type: '',\r\n          workshops: [],\r\n          is_active: true,\r\n        },\r\n        roles: [],\r\n        workshops: [],\r\n      };\r\n    },\r\n    async created() {\r\n      const { id } = this.$route.params;\r\n      this.editMode = !!id;\r\n      this.userId = id;\r\n  \r\n      try {\r\n        const metaRes = await fetch(this.editMode ? `/api/admin/users/${id}/edit` : `/api/admin/users/create`);\r\n        const metaData = await metaRes.json();\r\n        this.roles = metaData.roles;\r\n        this.workshops = metaData.workshops;\r\n  \r\n        if (this.editMode) {\r\n          const u = metaData.user_obj;\r\n          this.form.name = u.name;\r\n          this.form.username = u.username;\r\n          this.form.password = u.password || 'placeholder';\r\n          this.form.user_type = u.user_type;\r\n          this.form.workshops = metaData.user_workshops;\r\n          this.form.is_active = u.is_active ?? true;\r\n        }\r\n  \r\n      } catch (err) {\r\n        console.error(\"Ошибка при загрузке данных:\", err);\r\n      }\r\n    },\r\n    methods: {\r\n      async submitForm() {\r\n        const payload = { ...this.form };\r\n  \r\n        // Создание пользователя\r\n        if (!this.editMode) {\r\n          const response = await fetch('/api/admin/users/create', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify(payload),\r\n          });\r\n  \r\n          if (response.ok) {\r\n            this.$router.push('/admin/users');\r\n          } else {\r\n            const error = await response.json();\r\n            alert(`Ошибка создания: ${error.detail}`);\r\n          }\r\n        } else {\r\n          // TODO: Добавить POST-запрос для редактирования\r\n          alert('Редактирование пока не реализовано');\r\n        }\r\n      }\r\n    }\r\n  };\r\n  </script>\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}