{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { fetchWithToken } from '@/utils/api'; // Импортируем функцию для запросов\n\nexport default {\n  name: 'UserForm',\n  data() {\n    return {\n      editMode: false,\n      userId: null,\n      form: {\n        name: '',\n        firstname: '',\n        username: '',\n        password: '',\n        user_type: '',\n        workshops: [],\n        is_active: true\n      },\n      roles: [],\n      workshops: []\n    };\n  },\n  async created() {\n    const {\n      id\n    } = this.$route.params;\n    this.editMode = !!id;\n    this.userId = id;\n    try {\n      const metaRes = await fetchWithToken(this.editMode ? `/api/admin/users/${id}/edit` : `/api/admin/users/create`); // Используем fetchWithToken\n      const metaData = metaRes;\n      this.roles = metaData.roles;\n      this.workshops = metaData.workshops;\n      if (this.editMode) {\n        const u = metaData.user_obj;\n        this.form.name = u.name;\n        this.form.firstname = u.firstname;\n        this.form.username = u.username;\n        this.form.user_type = u.user_type;\n        this.form.workshops = metaData.user_workshops;\n        this.form.is_active = u.is_active ?? true;\n      }\n    } catch (err) {\n      console.error(\"Ошибка при загрузке данных:\", err);\n    }\n  },\n  methods: {\n    async submitForm() {\n      const payload = {\n        ...this.form\n      };\n      if (this.editMode) {\n        payload.id = this.userId;\n        // Если не меняем пароль — можно удалить поле или поставить \"заглушку\"\n        // delete payload.password;\n      }\n      try {\n        const response = await fetchWithToken('/api/admin/users/save', {\n          method: 'POST',\n          body: JSON.stringify(payload)\n        });\n        const data = await response.json(); // Получаем данные ответа\n\n        if (response.ok) {\n          // Если в ответе есть поле redirect_url, выполняем редирект\n          if (data.redirect_url) {\n            this.$router.push(data.redirect_url); // Перенаправляем на новый URL\n          }\n        } else {\n          alert(`Ошибка: ${data.message || 'Неизвестная ошибка'}`);\n        }\n      } catch (error) {\n        alert(`Ошибка: ${error.message}`);\n      }\n    }\n  }\n};","map":{"version":3,"names":["fetchWithToken","name","data","editMode","userId","form","firstname","username","password","user_type","workshops","is_active","roles","created","id","$route","params","metaRes","metaData","u","user_obj","user_workshops","err","console","error","methods","submitForm","payload","response","method","body","JSON","stringify","json","ok","redirect_url","$router","push","alert","message"],"sources":["C:\\task_manager_home\\src\\components\\UserForm.vue"],"sourcesContent":["<template>\r\n    <div class=\"container py-4\">\r\n      <h1>{{ editMode ? 'Редактировать' : 'Добавить' }} пользователя</h1>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Имя</label>\r\n          <input v-model=\"form.name\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n        <div v-if=\"editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Фамилия</label>\r\n          <input v-model=\"form.firstname\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Логин</label>\r\n          <input v-model=\"form.username\" type=\"text\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div v-if=\"!editMode\" class=\"mb-3\">\r\n          <label class=\"form-label\">Пароль</label>\r\n          <input v-model=\"form.password\" type=\"password\" class=\"form-control\" required>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Должность</label>\r\n          <select v-model=\"form.user_type\" class=\"form-select\" required>\r\n            <option v-for=\"role in roles\" :key=\"role\" :value=\"role\">{{ role }}</option>\r\n          </select>\r\n        </div>\r\n  \r\n        <div class=\"mb-3\">\r\n          <label class=\"form-label\">Цех</label>\r\n          <select v-model=\"form.workshops\" class=\"form-select\" multiple required>\r\n            <option v-for=\"workshop in workshops\" :key=\"workshop\" :value=\"workshop\">{{ workshop }}</option>\r\n          </select>\r\n          <small class=\"text-muted\">Удерживайте Ctrl (Cmd на Mac), чтобы выбрать несколько</small>\r\n        </div>\r\n  \r\n        <div v-if=\"editMode\" class=\"form-check\">\r\n          <input class=\"form-check-input\" type=\"checkbox\" v-model=\"form.is_active\" />\r\n          <label class=\"form-check-label\">Активен</label>\r\n        </div>\r\n  \r\n        <button type=\"submit\" class=\"btn btn-primary mt-3\">Сохранить</button>\r\n        <router-link to=\"/admin/users\" class=\"btn btn-secondary mt-3 ms-2\">Отмена</router-link>\r\n      </form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script>\r\n  import { fetchWithToken } from '@/utils/api';  // Импортируем функцию для запросов\r\n\r\n  export default {\r\n    name: 'UserForm',\r\n    data() {\r\n      return {\r\n        editMode: false,\r\n        userId: null,\r\n        form: {\r\n          name: '',\r\n          firstname: '',\r\n          username: '',\r\n          password: '',\r\n          user_type: '',\r\n          workshops: [],\r\n          is_active: true,\r\n        },\r\n        roles: [],\r\n        workshops: [],\r\n      };\r\n    },\r\n    async created() {\r\n      const { id } = this.$route.params;\r\n      this.editMode = !!id;\r\n      this.userId = id;\r\n      \r\n      try {\r\n        const metaRes = await fetchWithToken(this.editMode \r\n          ? `/api/admin/users/${id}/edit` \r\n          : `/api/admin/users/create`); // Используем fetchWithToken\r\n        const metaData = metaRes;\r\n\r\n        this.roles = metaData.roles;\r\n        this.workshops = metaData.workshops;\r\n\r\n        if (this.editMode) {\r\n          const u = metaData.user_obj;\r\n          this.form.name = u.name;\r\n          this.form.firstname = u.firstname;\r\n          this.form.username = u.username;\r\n          this.form.user_type = u.user_type;\r\n          this.form.workshops = metaData.user_workshops;\r\n          this.form.is_active = u.is_active ?? true;\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Ошибка при загрузке данных:\", err);\r\n      }\r\n    },\r\n    methods: {\r\n      async submitForm() {\r\n        const payload = { ...this.form };\r\n\r\n        if (this.editMode) {\r\n          payload.id = this.userId;\r\n          // Если не меняем пароль — можно удалить поле или поставить \"заглушку\"\r\n          // delete payload.password;\r\n        }\r\n\r\n        try {\r\n          const response = await fetchWithToken('/api/admin/users/save', {\r\n      method: 'POST',\r\n      body: JSON.stringify(payload),\r\n    });\r\n\r\n    const data = await response.json();  // Получаем данные ответа\r\n\r\n    if (response.ok) {\r\n      // Если в ответе есть поле redirect_url, выполняем редирект\r\n      if (data.redirect_url) {\r\n        this.$router.push(data.redirect_url); // Перенаправляем на новый URL\r\n      }\r\n    } else {\r\n      alert(`Ошибка: ${data.message || 'Неизвестная ошибка'}`);\r\n    }\r\n  } catch (error) {\r\n    alert(`Ошибка: ${error.message}`);\r\n  }\r\n}\r\n    }\r\n  };\r\n</script>\r\n"],"mappings":";AAiDE,SAASA,cAAa,QAAS,aAAa,EAAG;;AAE/C,eAAe;EACbC,IAAI,EAAE,UAAU;EAChBC,IAAIA,CAAA,EAAG;IACL,OAAO;MACLC,QAAQ,EAAE,KAAK;MACfC,MAAM,EAAE,IAAI;MACZC,IAAI,EAAE;QACJJ,IAAI,EAAE,EAAE;QACRK,SAAS,EAAE,EAAE;QACbC,QAAQ,EAAE,EAAE;QACZC,QAAQ,EAAE,EAAE;QACZC,SAAS,EAAE,EAAE;QACbC,SAAS,EAAE,EAAE;QACbC,SAAS,EAAE;MACb,CAAC;MACDC,KAAK,EAAE,EAAE;MACTF,SAAS,EAAE;IACb,CAAC;EACH,CAAC;EACD,MAAMG,OAAOA,CAAA,EAAG;IACd,MAAM;MAAEC;IAAG,IAAI,IAAI,CAACC,MAAM,CAACC,MAAM;IACjC,IAAI,CAACb,QAAO,GAAI,CAAC,CAACW,EAAE;IACpB,IAAI,CAACV,MAAK,GAAIU,EAAE;IAEhB,IAAI;MACF,MAAMG,OAAM,GAAI,MAAMjB,cAAc,CAAC,IAAI,CAACG,QAAO,GAC7C,oBAAoBW,EAAE,OAAM,GAC5B,yBAAyB,CAAC,EAAE;MAChC,MAAMI,QAAO,GAAID,OAAO;MAExB,IAAI,CAACL,KAAI,GAAIM,QAAQ,CAACN,KAAK;MAC3B,IAAI,CAACF,SAAQ,GAAIQ,QAAQ,CAACR,SAAS;MAEnC,IAAI,IAAI,CAACP,QAAQ,EAAE;QACjB,MAAMgB,CAAA,GAAID,QAAQ,CAACE,QAAQ;QAC3B,IAAI,CAACf,IAAI,CAACJ,IAAG,GAAIkB,CAAC,CAAClB,IAAI;QACvB,IAAI,CAACI,IAAI,CAACC,SAAQ,GAAIa,CAAC,CAACb,SAAS;QACjC,IAAI,CAACD,IAAI,CAACE,QAAO,GAAIY,CAAC,CAACZ,QAAQ;QAC/B,IAAI,CAACF,IAAI,CAACI,SAAQ,GAAIU,CAAC,CAACV,SAAS;QACjC,IAAI,CAACJ,IAAI,CAACK,SAAQ,GAAIQ,QAAQ,CAACG,cAAc;QAC7C,IAAI,CAAChB,IAAI,CAACM,SAAQ,GAAIQ,CAAC,CAACR,SAAQ,IAAK,IAAI;MAC3C;IACF,EAAE,OAAOW,GAAG,EAAE;MACZC,OAAO,CAACC,KAAK,CAAC,6BAA6B,EAAEF,GAAG,CAAC;IACnD;EACF,CAAC;EACDG,OAAO,EAAE;IACP,MAAMC,UAAUA,CAAA,EAAG;MACjB,MAAMC,OAAM,GAAI;QAAE,GAAG,IAAI,CAACtB;MAAK,CAAC;MAEhC,IAAI,IAAI,CAACF,QAAQ,EAAE;QACjBwB,OAAO,CAACb,EAAC,GAAI,IAAI,CAACV,MAAM;QACxB;QACA;MACF;MAEA,IAAI;QACF,MAAMwB,QAAO,GAAI,MAAM5B,cAAc,CAAC,uBAAuB,EAAE;UACnE6B,MAAM,EAAE,MAAM;UACdC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACL,OAAO;QAC9B,CAAC,CAAC;QAEF,MAAMzB,IAAG,GAAI,MAAM0B,QAAQ,CAACK,IAAI,CAAC,CAAC,EAAG;;QAErC,IAAIL,QAAQ,CAACM,EAAE,EAAE;UACf;UACA,IAAIhC,IAAI,CAACiC,YAAY,EAAE;YACrB,IAAI,CAACC,OAAO,CAACC,IAAI,CAACnC,IAAI,CAACiC,YAAY,CAAC,EAAE;UACxC;QACF,OAAO;UACLG,KAAK,CAAC,WAAWpC,IAAI,CAACqC,OAAM,IAAK,oBAAoB,EAAE,CAAC;QAC1D;MACF,EAAE,OAAOf,KAAK,EAAE;QACdc,KAAK,CAAC,WAAWd,KAAK,CAACe,OAAO,EAAE,CAAC;MACnC;IACF;EACI;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}