{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport { ref, reactive, onMounted } from 'vue';\nimport ProductForm from './ProductForm.vue'; // Компонент для одного изделия\n\nexport default {\n  __name: 'CreateBid',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const form = reactive({\n      task_number: '',\n      customer_id: '',\n      manager: '',\n      status: ''\n    });\n    const newCustomer = ref('');\n    const files = ref([]);\n    const customers = ref([]);\n    const managers = ref([]);\n    const statuses = ref([]);\n    const products = ref([]);\n    onMounted(async () => {\n      customers.value = await (await fetch('/customers/')).json();\n      managers.value = [...JSON.parse('{{ managers | tojson | safe }}')]; // или передать через props\n      statuses.value = [...JSON.parse('{{ status | tojson | safe }}')]; // то же самое\n    });\n    function handleCustomerChange() {\n      if (form.customer_id !== 'new') newCustomer.value = '';\n    }\n    function addProduct() {\n      products.value.push({});\n    }\n    function removeLastProduct() {\n      products.value.pop();\n    }\n    function updateProduct(index, data) {\n      products.value[index] = data;\n    }\n    function removeProduct(index) {\n      products.value.splice(index, 1);\n    }\n    function handleFileUpload(event) {\n      files.value = Array.from(event.target.files);\n    }\n    async function submitForm() {\n      const payload = {\n        ...form,\n        new_customer: form.customer_id === 'new' ? newCustomer.value : undefined,\n        products: products.value,\n        files: files.value.map(f => f.name)\n      };\n      const formData = new FormData();\n      formData.append('bid_data', JSON.stringify(payload));\n      files.value.forEach(file => formData.append('files', file));\n      const response = await fetch('/bids/create/', {\n        method: 'POST',\n        body: formData\n      });\n      const result = await response.json();\n      if (response.ok) {\n        alert('Заявка успешно создана!');\n      } else {\n        alert('Ошибка: ' + result.message);\n      }\n    }\n    const __returned__ = {\n      form,\n      newCustomer,\n      files,\n      customers,\n      managers,\n      statuses,\n      products,\n      handleCustomerChange,\n      addProduct,\n      removeLastProduct,\n      updateProduct,\n      removeProduct,\n      handleFileUpload,\n      submitForm,\n      ref,\n      reactive,\n      onMounted,\n      ProductForm\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","ProductForm","form","task_number","customer_id","manager","status","newCustomer","files","customers","managers","statuses","products","value","fetch","json","JSON","parse","handleCustomerChange","addProduct","push","removeLastProduct","pop","updateProduct","index","data","removeProduct","splice","handleFileUpload","event","Array","from","target","submitForm","payload","new_customer","undefined","map","f","name","formData","FormData","append","stringify","forEach","file","response","method","body","result","ok","alert","message"],"sources":["C:/Users/nikec/frontend/src/components/CreateBid.vue"],"sourcesContent":["<template>\r\n    <div>\r\n      <h2>Создание заявки</h2>\r\n      <form @submit.prevent=\"submitForm\">\r\n        <!-- Первая строка: кнопки -->\r\n        <div class=\"button-group\">\r\n          <button type=\"button\" @click=\"addProduct\">Добавить изделие</button>\r\n          <button type=\"button\" @click=\"removeLastProduct\">Удалить последнее изделие</button>\r\n        </div>\r\n  \r\n        <!-- Вторая строка: Номер заявки, заказчик, менеджер -->\r\n        <div class=\"form-row\">\r\n          <input v-model=\"form.task_number\" type=\"number\" placeholder=\"Номер заявки\" />\r\n  \r\n          <select v-model=\"form.customer_id\" @change=\"handleCustomerChange\">\r\n            <option value=\"\">Выберите заказчика</option>\r\n            <option v-for=\"customer in customers\" :key=\"customer.id\" :value=\"customer.id\">{{ customer.name }}</option>\r\n            <option value=\"new\">Добавить нового</option>\r\n          </select>\r\n  \r\n          <input v-if=\"form.customer_id === 'new'\" v-model=\"newCustomer\" placeholder=\"Новый заказчик\" />\r\n  \r\n          <select v-model=\"form.manager\">\r\n            <option value=\"\">Выберите менеджера</option>\r\n            <option v-for=\"manager in managers\" :key=\"manager.name\" :value=\"manager.name\">{{ manager.value }}</option>\r\n          </select>\r\n        </div>\r\n  \r\n        <!-- Изделия -->\r\n        <div v-for=\"(product, index) in products\" :key=\"index\" class=\"product-row\">\r\n          <!-- Здесь будут дочерние компоненты -->\r\n          <ProductForm\r\n            :product=\"product\"\r\n            :index=\"index\"\r\n            @update=\"updateProduct(index, $event)\"\r\n            @remove=\"removeProduct(index)\"\r\n          />\r\n        </div>\r\n  \r\n        <!-- Загрузка файлов -->\r\n        <div class=\"form-row\">\r\n          <label for=\"file-upload\">Загрузить файлы:</label>\r\n          <input id=\"file-upload\" type=\"file\" multiple @change=\"handleFileUpload\" />\r\n        </div>\r\n  \r\n        <!-- Статус -->\r\n        <div class=\"form-row\">\r\n          <select v-model=\"form.status\">\r\n            <option value=\"\">Выберите статус</option>\r\n            <option v-for=\"status in statuses\" :value=\"status.name\">{{ status.value }}</option>\r\n          </select>\r\n        </div>\r\n  \r\n        <!-- Кнопка отправки -->\r\n        <button type=\"submit\">Отправить заявку</button>\r\n      </form>\r\n    </div>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref, reactive, onMounted } from 'vue';\r\n  import ProductForm from './ProductForm.vue'; // Компонент для одного изделия\r\n  \r\n  const form = reactive({\r\n    task_number: '',\r\n    customer_id: '',\r\n    manager: '',\r\n    status: '',\r\n  });\r\n  \r\n  const newCustomer = ref('');\r\n  const files = ref([]);\r\n  const customers = ref([]);\r\n  const managers = ref([]);\r\n  const statuses = ref([]);\r\n  const products = ref([]);\r\n  \r\n  onMounted(async () => {\r\n    customers.value = await (await fetch('/customers/')).json();\r\n    managers.value = [...JSON.parse('{{ managers | tojson | safe }}')]; // или передать через props\r\n    statuses.value = [...JSON.parse('{{ status | tojson | safe }}')];   // то же самое\r\n  });\r\n  \r\n  function handleCustomerChange() {\r\n    if (form.customer_id !== 'new') newCustomer.value = '';\r\n  }\r\n  \r\n  function addProduct() {\r\n    products.value.push({});\r\n  }\r\n  \r\n  function removeLastProduct() {\r\n    products.value.pop();\r\n  }\r\n  \r\n  function updateProduct(index, data) {\r\n    products.value[index] = data;\r\n  }\r\n  \r\n  function removeProduct(index) {\r\n    products.value.splice(index, 1);\r\n  }\r\n  \r\n  function handleFileUpload(event) {\r\n    files.value = Array.from(event.target.files);\r\n  }\r\n  \r\n  async function submitForm() {\r\n    const payload = {\r\n      ...form,\r\n      new_customer: form.customer_id === 'new' ? newCustomer.value : undefined,\r\n      products: products.value,\r\n      files: files.value.map(f => f.name),\r\n    };\r\n  \r\n    const formData = new FormData();\r\n    formData.append('bid_data', JSON.stringify(payload));\r\n    files.value.forEach(file => formData.append('files', file));\r\n  \r\n    const response = await fetch('/bids/create/', {\r\n      method: 'POST',\r\n      body: formData,\r\n    });\r\n  \r\n    const result = await response.json();\r\n    if (response.ok) {\r\n      alert('Заявка успешно создана!');\r\n    } else {\r\n      alert('Ошибка: ' + result.message);\r\n    }\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  /* Можно скопировать стили из HTML или написать на Tailwind / Bootstrap */\r\n  </style>\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}