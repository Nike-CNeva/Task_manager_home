{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, reactive, watch, onMounted } from 'vue';\nexport default {\n  __name: 'ProductForm',\n  props: ['product', 'index'],\n  emits: ['update', 'remove'],\n  setup(__props, {\n    expose: __expose,\n    emit: __emit\n  }) {\n    __expose();\n    const props = __props;\n    const emits = __emit;\n    const productData = reactive({\n      product_id: '',\n      material: '',\n      material_type: '',\n      thickness: '',\n      product_details: {},\n      sheets: []\n    });\n    const productOptions = ref([]);\n    const productFields = ref([]);\n    const materialForms = ref([]);\n    const materialTypes = ref([]);\n    const thicknesses = ref([]);\n    const showSheets = ref(false);\n    const sheets = ref([]);\n    const urgency = ref('');\n    const comment = ref('');\n    const workshops = ref([]);\n    const employees = ref([]);\n    const urgencies = ref([]);\n    const allWorkshops = ref([]);\n    const allEmployees = ref([]);\n    onMounted(async () => {\n      productOptions.value = await (await fetch('/products/')).json();\n      urgencies.value = await (await fetch('/urgency/')).json();\n      allWorkshops.value = await (await fetch('/workshops/')).json();\n      allEmployees.value = await (await fetch('/employee/')).json();\n    });\n    watch([productData, urgency, comment, workshops, employees, sheets], () => {\n      emits('update', {\n        ...productData,\n        urgency: urgency.value,\n        comment: comment.value,\n        workshops: [...workshops.value],\n        employees: [...employees.value],\n        sheets: sheets.value\n      });\n    }, {\n      deep: true\n    });\n    async function handleProductChange() {\n      const pid = productData.product_id;\n      productFields.value = await (await fetch(`/products/${pid}/fields`)).json();\n      materialForms.value = await (await fetch(`/material/forms/${pid}`)).json();\n      if (['CASSETTE', 'SHEET'].includes(pid)) {\n        showSheets.value = true;\n      } else {\n        showSheets.value = false;\n        sheets.value = [];\n      }\n    }\n    function handleSpecialField(name) {\n      if (name === 'profile_type_id' || name === 'cassette_type_id') {\n        // просто триггерим пересборку данных\n      }\n    }\n    async function loadMaterialTypes() {\n      const pid = productData.product_id;\n      const form = productData.material;\n      materialTypes.value = await (await fetch(`/material/types/${pid}/${form}`)).json();\n      if (materialTypes.value.length) {\n        productData.material_type = materialTypes.value[0].name;\n        await loadThickness();\n      }\n    }\n    async function loadThickness() {\n      thicknesses.value = await (await fetch(`/material/thickness/${productData.material_type}`)).json();\n    }\n    function addSheet() {\n      sheets.value.push({\n        width: 0,\n        length: 0,\n        quantity: 1\n      });\n    }\n    function removeSheet() {\n      sheets.value.pop();\n    }\n    const __returned__ = {\n      props,\n      emits,\n      productData,\n      productOptions,\n      productFields,\n      materialForms,\n      materialTypes,\n      thicknesses,\n      showSheets,\n      sheets,\n      urgency,\n      comment,\n      workshops,\n      employees,\n      urgencies,\n      allWorkshops,\n      allEmployees,\n      handleProductChange,\n      handleSpecialField,\n      loadMaterialTypes,\n      loadThickness,\n      addSheet,\n      removeSheet,\n      ref,\n      reactive,\n      watch,\n      onMounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","watch","onMounted","props","__props","emits","__emit","productData","product_id","material","material_type","thickness","product_details","sheets","productOptions","productFields","materialForms","materialTypes","thicknesses","showSheets","urgency","comment","workshops","employees","urgencies","allWorkshops","allEmployees","value","fetch","json","deep","handleProductChange","pid","includes","handleSpecialField","name","loadMaterialTypes","form","length","loadThickness","addSheet","push","width","quantity","removeSheet","pop"],"sources":["C:/Users/nikec/frontend/src/components/ProductForm.vue"],"sourcesContent":["<template>\r\n    <div class=\"product-container\">\r\n      <!-- Выбор изделия -->\r\n      <select v-model=\"productData.product_id\" @change=\"handleProductChange\">\r\n        <option value=\"\">Выберите изделие</option>\r\n        <option v-for=\"product in productOptions\" :key=\"product.value\" :value=\"product.value\">\r\n          {{ product.label }}\r\n        </option>\r\n      </select>\r\n  \r\n      <!-- Поля изделия -->\r\n      <div v-if=\"productFields.length\" class=\"product-fields\">\r\n        <div v-for=\"field in productFields\" :key=\"field.name\">\r\n          <template v-if=\"field.type === 'select'\">\r\n            <select :name=\"field.name\" v-model=\"productData.product_details[field.name]\" @change=\"handleSpecialField(field.name)\">\r\n              <option value=\"\">{{ field.label }}</option>\r\n              <option v-for=\"opt in field.options\" :value=\"opt.value\">{{ opt.label }}</option>\r\n            </select>\r\n          </template>\r\n  \r\n          <template v-else-if=\"field.type === 'checkbox'\">\r\n            <label>\r\n              <input type=\"checkbox\" :name=\"field.name\" v-model=\"productData.product_details[field.name]\" />\r\n              {{ field.label }}\r\n            </label>\r\n          </template>\r\n  \r\n          <template v-else>\r\n            <input :type=\"field.type\" :name=\"field.name\" :placeholder=\"field.label\" v-model=\"productData.product_details[field.name]\" />\r\n          </template>\r\n        </div>\r\n  \r\n        <!-- Нестандартный профиль -->\r\n        <input v-if=\"productData.product_details.profile_type_id === '11'\" type=\"text\" placeholder=\"Введите тип профиля\"\r\n               v-model=\"productData.product_details.custom_profile_type\" />\r\n        <!-- Нестандартная кассета -->\r\n        <input v-if=\"productData.product_details.cassette_type_id === 'OTHER'\" type=\"text\" placeholder=\"Описание кассеты\"\r\n               v-model=\"productData.product_details.custom_cassette_type\" />\r\n      </div>\r\n  \r\n      <!-- Материалы -->\r\n      <div class=\"material-fields\" v-if=\"materialForms.length\">\r\n        <select v-model=\"productData.material\" @change=\"loadMaterialTypes\">\r\n          <option value=\"\">Выберите форму материала</option>\r\n          <option v-for=\"form in materialForms\" :key=\"form.name\" :value=\"form.name\">{{ form.value }}</option>\r\n        </select>\r\n      </div>\r\n  \r\n      <div v-if=\"materialTypes.length\">\r\n        <select v-model=\"productData.material_type\" @change=\"loadThickness\">\r\n          <option value=\"\">Выберите тип материала</option>\r\n          <option v-for=\"type in materialTypes\" :key=\"type.name\" :value=\"type.name\">{{ type.value }}</option>\r\n        </select>\r\n      </div>\r\n  \r\n      <div v-if=\"thicknesses.length\">\r\n        <select v-model=\"productData.thickness\">\r\n          <option value=\"\">Выберите толщину</option>\r\n          <option v-for=\"thick in thicknesses\" :key=\"thick.name\" :value=\"thick.name\">{{ thick.value }}</option>\r\n        </select>\r\n      </div>\r\n  \r\n      <!-- Листы -->\r\n      <div v-if=\"showSheets\">\r\n        <div v-for=\"(sheet, i) in sheets\" :key=\"i\" class=\"sheet-fields\">\r\n          <input type=\"number\" placeholder=\"Ширина листа\" v-model.number=\"sheet.width\" />\r\n          <input type=\"number\" placeholder=\"Длина листа\" v-model.number=\"sheet.length\" />\r\n          <input type=\"number\" placeholder=\"Количество листов\" v-model.number=\"sheet.quantity\" />\r\n        </div>\r\n        <button type=\"button\" @click=\"addSheet\">Добавить лист</button>\r\n        <button type=\"button\" @click=\"removeSheet\">Удалить лист</button>\r\n      </div>\r\n  \r\n      <!-- Назначения -->\r\n      <div class=\"assignment-container\">\r\n        <select v-model=\"urgency\">\r\n          <option value=\"\">Выберите срочность</option>\r\n          <option v-for=\"u in urgencies\" :key=\"u\" :value=\"u\">{{ u }}</option>\r\n        </select>\r\n  \r\n        <label>Назначить цех:</label>\r\n        <select v-model=\"workshops\" multiple>\r\n          <option v-for=\"ws in allWorkshops\" :value=\"ws.id\">{{ ws.name }}</option>\r\n        </select>\r\n  \r\n        <label>Назначить сотрудников:</label>\r\n        <select v-model=\"employees\" multiple>\r\n          <option v-for=\"emp in allEmployees\" :key=\"emp.id\" :value=\"emp.id\">{{ emp.name }} {{ emp.firstname }}</option>\r\n        </select>\r\n  \r\n        <textarea v-model=\"comment\" placeholder=\"Введите комментарий...\" rows=\"3\" style=\"width: 100%\"></textarea>\r\n      </div>\r\n    </div>\r\n  </template>\r\n  \r\n  <script setup>\r\n  import { ref, reactive, watch, onMounted } from 'vue';\r\n  \r\n  const props = defineProps(['product', 'index']);\r\n  const emits = defineEmits(['update', 'remove']);\r\n  \r\n  const productData = reactive({\r\n    product_id: '',\r\n    material: '',\r\n    material_type: '',\r\n    thickness: '',\r\n    product_details: {},\r\n    sheets: [],\r\n  });\r\n  \r\n  const productOptions = ref([]);\r\n  const productFields = ref([]);\r\n  const materialForms = ref([]);\r\n  const materialTypes = ref([]);\r\n  const thicknesses = ref([]);\r\n  const showSheets = ref(false);\r\n  \r\n  const sheets = ref([]);\r\n  \r\n  const urgency = ref('');\r\n  const comment = ref('');\r\n  const workshops = ref([]);\r\n  const employees = ref([]);\r\n  \r\n  const urgencies = ref([]);\r\n  const allWorkshops = ref([]);\r\n  const allEmployees = ref([]);\r\n  \r\n  onMounted(async () => {\r\n    productOptions.value = await (await fetch('/products/')).json();\r\n    urgencies.value = await (await fetch('/urgency/')).json();\r\n    allWorkshops.value = await (await fetch('/workshops/')).json();\r\n    allEmployees.value = await (await fetch('/employee/')).json();\r\n  });\r\n  \r\n  watch([productData, urgency, comment, workshops, employees, sheets], () => {\r\n    emits('update', {\r\n      ...productData,\r\n      urgency: urgency.value,\r\n      comment: comment.value,\r\n      workshops: [...workshops.value],\r\n      employees: [...employees.value],\r\n      sheets: sheets.value,\r\n    });\r\n  }, { deep: true });\r\n  \r\n  async function handleProductChange() {\r\n    const pid = productData.product_id;\r\n    productFields.value = await (await fetch(`/products/${pid}/fields`)).json();\r\n    materialForms.value = await (await fetch(`/material/forms/${pid}`)).json();\r\n    if (['CASSETTE', 'SHEET'].includes(pid)) {\r\n      showSheets.value = true;\r\n    } else {\r\n      showSheets.value = false;\r\n      sheets.value = [];\r\n    }\r\n  }\r\n  \r\n  function handleSpecialField(name) {\r\n    if (name === 'profile_type_id' || name === 'cassette_type_id') {\r\n      // просто триггерим пересборку данных\r\n    }\r\n  }\r\n  \r\n  async function loadMaterialTypes() {\r\n    const pid = productData.product_id;\r\n    const form = productData.material;\r\n    materialTypes.value = await (await fetch(`/material/types/${pid}/${form}`)).json();\r\n    if (materialTypes.value.length) {\r\n      productData.material_type = materialTypes.value[0].name;\r\n      await loadThickness();\r\n    }\r\n  }\r\n  \r\n  async function loadThickness() {\r\n    thicknesses.value = await (await fetch(`/material/thickness/${productData.material_type}`)).json();\r\n  }\r\n  \r\n  function addSheet() {\r\n    sheets.value.push({ width: 0, length: 0, quantity: 1 });\r\n  }\r\n  \r\n  function removeSheet() {\r\n    sheets.value.pop();\r\n  }\r\n  </script>\r\n  \r\n  <style scoped>\r\n  .product-container {\r\n    border: 1px solid #ccc;\r\n    padding: 10px;\r\n    margin-bottom: 15px;\r\n    border-radius: 10px;\r\n  }\r\n  </style>\r\n  "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}